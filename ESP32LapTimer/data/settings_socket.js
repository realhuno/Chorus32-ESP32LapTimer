import*as e from"./constants.js";var t=null;function n(e,n,i,o,s){t.send(`${e}R${n}${i}${o.toString(16).padStart(s/4,"0").toUpperCase()}\n`)}function i(t,i,o,s){n(e.EXTENDED_PREFIX,t,i,o,s)}function o(e,t,n){i("*",e,t,n)}function s(e,t,i,o){n("",e,t,i,o)}function a(){t.send("ER*a\n"),t.send("R*a\n")}function l(e){e.setAttribute("val_state","pending")}function E(e){e.setAttribute("val_state","received")}function c(t){if("B"==t[0]){switch(l=t[1]){case e.BINARY_RSSI:var n=t[2]<<24&65535|t[3]<<16&65535|t[4]<<8&65535|65535&t[5],i=(255&t[6])<<8|255&t[7];console.log("Got binary! with time "+n+" and rssi "+i+" message: "+t)}}else{var o="E"==t[0];o&&(t=t.substr(1));var s=parseInt(t[1]),l=t[2];if(o)switch(l){case e.EXTENDED_VOLTAGE_TYPE:(c=document.getElementById("ADCVBATmode")).value=parseInt(t[3],16),E(c);break;case e.EXTENDED_VOLTAGE_CALIB:(c=document.getElementById("ADCcalibValue")).value=parseInt(t.substr(3),16)/1e3,E(c);break;case e.EXTENDED_EEPROM_RESET:E(c=document.getElementById("eepromReset")),a();break;case e.EXTENDED_DISPLAY_TIMEOUT:(c=document.getElementById("displayTimeout")).value=parseInt(t.substr(3),16),E(c);break;case e.EXTENDED_WIFI_CHANNEL:(c=document.getElementById("WiFiChannel")).value=parseInt(t[3],16),E(c);break;case e.EXTENDED_WIFI_PROTOCOL:(c=document.getElementById("WiFiProtocol")).value=parseInt(t[3],16),E(c);break;case e.EXTENDED_FILTER_CUTOFF:(c=document.getElementById("RXFilterCutoff")).value=parseInt(t.substr(3),16),E(c);break;case e.EXTENDED_NUM_MODULES:(c=document.getElementById("NumRXs")).value=parseInt(t[3],16),E(c);break;case e.EXTENDED_MULTIPLEX_OFF:(c=document.getElementById("pilot_multuplex_off_"+s)).checked=1==parseInt(t[3]),E(c);break;case e.EXTENDED_CALIB_MIN:(c=document.getElementById("calib_table")).rows[s+1].cells[1].innerText=parseInt(t.substr(3),16);break;case e.EXTENDED_CALIB_MAX:(c=document.getElementById("calib_table")).rows[s+1].cells[2].innerText=parseInt(t.substr(3),16);break;case e.EXTENDED_CALIB_STATUS:E(c=document.getElementById("calibrate_button"))}else switch(l){case e.RESPONSE_VOLTAGE:(c=document.getElementById("Var_VBAT")).innerText=(parseInt(t.substr(3),16)*(5/1024)*11).toFixed(2);break;case e.RESPONSE_THRESHOLD:(c=document.getElementById("RSSIthreshold"+s)).value=parseInt(t.substr(3),16),E(c);break;case e.RESPONSE_PILOT_ACTIVE:(c=document.getElementById("pilot_enabled_"+s)).checked=1==parseInt(t[3]),E(c);break;case e.RESPONSE_BAND:(c=document.getElementById("band"+s)).value=t[3],E(c);break;case e.RESPONSE_CHANNEL:var c;(c=document.getElementById("channel"+s)).value=t[3],E(c)}}}function u(e){console.log(e.data);for(var t=e.data.split("\n"),n=0;n<t.length;++n)c(t[n])}!function(){for(var t=0;t<8;++t){var n,o=document.getElementById("pilot_table").insertRow(-1);o.insertCell(-1).innerText=t+1;var a="";a=`<select class="band_select" name="band${t}" id="band${t}">`,a+='<option selected="" value="0">R</option><option value="1">A</option><option value="2">B</option><option value="3">E</option><option value="4">F</option><option value="5">D</option><option value="6">Connex</option><option value="7">Connex2</option></select>',(n=o.insertCell(-1)).innerHTML=a,n.lastChild.onclick=function(){l(this),s(parseInt(this.id.slice(-1)),e.CONTROL_BAND,parseInt(1*this.value),4)},a=`<select name="channel${t}" id="channel${t}" `,a+='class="channel_select"><option value="0">1</option><option value="1">2</option><option value="2">3</option><option value="3">4</option><option value="4">5</option><option value="5">6</option><option value="6">7</option><option value="7">8</option></select>',(n=o.insertCell(-1)).innerHTML=a,n.lastChild.onclick=function(){l(this),s(parseInt(this.id.slice(-1)),e.CONTROL_CHANNEL,parseInt(1*this.value),4)},a=`<input type="number" id="RSSIthreshold${t}" min="0" max="342" step="1" class="rssi_select">`,(n=o.insertCell(-1)).innerHTML=a,n.lastChild.onclick=function(){l(this),s(parseInt(this.id.slice(-1)),e.CONTROL_THRESHOLD,parseInt(1*this.value),16)},a=`<input type="checkbox" id="pilot_enabled_${t}">`,(n=o.insertCell(-1)).innerHTML=a,n.lastChild.onclick=function(){l(this),s(parseInt(this.id.slice(-1)),e.CONTROL_PILOT_ACTIVE,this.checked?1:0,4)},a=`<input type="checkbox" id="pilot_multuplex_off_${t}">`,(n=o.insertCell(-1)).innerHTML=a,n.lastChild.onclick=function(){l(this),i(parseInt(this.id.slice(-1)),e.EXTENDED_MULTIPLEX_OFF,this.checked?1:0,4)}}}(),function e(n){(t=new WebSocket(n)).onmessage=u,t.onclose=function(){setTimeout((function(){e(n)}),5e3)},t.onopen=function(){a()}}("ws://192.168.4.1/ws"),document.getElementById("ADCVBATmode").oninput=function(){l(this),t.send(`ER*${e.EXTENDED_VOLTAGE_TYPE}${this.value}\n`)},document.getElementById("ADCcalibValue").oninput=function(){(l(this),this.value.endsWith("."))?this.setAttribute("val_state","error"):o(e.EXTENDED_VOLTAGE_CALIB,parseInt(1e3*this.value),16)},document.getElementById("eepromReset").onclick=function(){l(this),t.send(`ER*${e.EXTENDED_EEPROM_RESET}\n`)},document.getElementById("displayTimeout").oninput=function(){l(this),o(e.EXTENDED_DISPLAY_TIMEOUT,parseInt(1*this.value),16)},document.getElementById("WiFiProtocol").oninput=function(){l(this),o(e.EXTENDED_WIFI_PROTOCOL,parseInt(this.value),4)},document.getElementById("WiFiChannel").oninput=function(){l(this),o(e.EXTENDED_WIFI_CHANNEL,parseInt(this.value),4)},document.getElementById("RXFilterCutoff").oninput=function(){l(this),o(e.EXTENDED_FILTER_CUTOFF,parseInt(1*this.value),16)},document.getElementById("NumRXs").oninput=function(){l(this),o(e.EXTENDED_NUM_MODULES,parseInt(1*this.value),4)},document.getElementById("calibrate_button").onclick=function(){l(this),t.send(`ER*${e.EXTENDED_CALIB_START}\n`)},setInterval((function(){t.send("R*v\n")}),2e3);